### Prerequisites

- Pulumi
- Docker
- AWS CLI v2

### Dev

Setting up infra locally:

```sh
yarn workspace @algwiki/infrastructure localstack
yarn workspace @algwiki/infrastructure pulumi up
```

Viewing logs for a resource:

```sh
aws --endpoint-url=http://localhost:4566 logs describe-log-groups
aws --endpoint-url=http://localhost:4566 logs tail /aws/lambda/submit-solution-handler-19ee373 --follow
```

Setting up infra on AWS for dev:

```sh
# yarn workspace @algwiki/infrastructure pulumi stack init dev
yarn workspace @algwiki/infrastructure pulumi stack select dev
yarn workspace @algwiki/infrastructure pulumi up
```

### Administrator access through AWS console

The live AlgWiki stack is only available to a select few. This is mostly to limit the potential of leaking data or breaking the stack (intentional or otherwise) but also to limit cheating since admin access allows viewing the solutions of active challenges in the database. In the future audit logs for the database may become public or solutions by admins which viewed the database while the challenge was active disqualified to prevent potential abuse. There are multiple people for redundancy (in case one admin is unavailable to perform a critical task).

#### Instructions for creating new admins

- Open IAM -> Access Management -> Users
- Click "Create user"
- Give them an appropriate username (eg. their AlgWiki name)
- Select credential type of _only_: `Password - AWS Management Console access`
- Make sure `Autogenerated password` and `User must create a new password at next sign-in` are checked
- Click next to "permissions" and add them to the `Admins` group
- Click next until clicking "create user" (do not add tags)
- Securely send them these instructions (ideally with something encrypted like Signal but email/Discord is alright too):
  - Go to https://console.aws.amazon.com/console/home to see the signin screen (log out if already logged into another account)
  - Select the "IAM user" login type
  - Enter account ID: `497605084935` (update to actual account ID)
  - Enter the username: `uuuuu` (update to actual username)
  - Enter the password: `xxxxx` (update to actual password)
  - Change the password to something secure (use a password manager!)
  - You should now be in the console, but you will not have permission to do anything until you've enabled MFA
  - Click on the dropdown with your account name and select `My Security Credentials`
  - Under `Account details` -> `AWS IAM credentials` -> `Multi-factor authentication (MFA)` click on `Assign MFA device` (ignore all the warnings about not having permissions)
  - Follow the steps to enable MFA
    - Install the Authy authenticator app on your phone if you do not have an MFA system already
  - Log out then back in using your new password and MFA
  - You should now be able to access all AlgWiki resources!
